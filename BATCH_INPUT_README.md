# 批量图片输入功能说明

## 🎯 问题解决

如果你的图片已经是**列表格式（batch）**，不需要再一个一个手动连接！

## 📦 新节点：多视角图片批量输入

### 节点名称
**MultiViewImageBatch** (多视角图片批量输入 📦)

### 功能
直接接受图片列表（batch）作为输入，自动处理为多视角图片格式。

### 输入
- `images`: IMAGE 类型（批量格式）
  - 形状：`[batch_size, height, width, channels]`
  - 例如：`[6, 512, 512, 3]` 表示 6 张 512x512 的 RGB 图片

### 输出
- `multi_view_images`: MULTI_VIEW_IMAGES 类型
  - 可以直接连接到 3D 预览节点

## 🆚 两种输入方式对比

### 方式1: 批量输入（推荐 ✨）

```
[图片列表/批量]
    ↓
[多视角图片批量输入] 📦
    ↓
[3D预览] 🎬
```

**优点：**
- ✅ 只需一根连线
- ✅ 自动处理所有图片
- ✅ 适合批量生成的图片
- ✅ 工作流更简洁

**适用场景：**
- 从视频提取的帧序列
- 批量生成的多角度图片
- 循环生成的图片列表
- 任何已经是 batch 格式的图片

### 方式2: 单个输入

```
[图片1] ──┐
[图片2] ──┤
[图片3] ──┼──> [多视角图片输入（单个）]
[图片4] ──┤         ↓
[图片5] ──┘    [3D预览] 🎬
```

**优点：**
- ✅ 可以选择性连接不同来源的图片
- ✅ 灵活控制每个图片输入

**适用场景：**
- 手动加载的单个图片文件
- 来自不同节点的图片
- 需要精确控制哪些图片参与预览

## 💡 使用示例

### 示例1: 从视频提取帧

```
[加载视频] 
    ↓
[提取帧序列] (输出: batch of 8 images)
    ↓
[多视角图片批量输入] 📦
    ↓
[3D预览] 🎬
```

### 示例2: 循环生成多角度图片

```
[文本提示词]
    ↓
[循环生成器] (生成 6 个不同角度)
    ↓
[批量图片] (6 images batch)
    ↓
[多视角图片批量输入] 📦
    ↓
[3D预览] 🎬
```

### 示例3: 结合文本列表

```
[角度列表] → [文本列表创建]
                ↓
            [提示词模板]
                ↓
            [批量生成]
                ↓
            [图片批量]
                ↓
        [多视角图片批量输入] 📦
                ↓
            [3D预览] 🎬
```

## 🔧 技术细节

### 输入格式

ComfyUI 中的 IMAGE 类型是批量格式：

```python
# 形状: [batch, height, width, channels]
images.shape = [6, 512, 512, 3]

# 含义:
# - 6 张图片
# - 每张 512x512 像素
# - RGB 3 通道
```

### 节点处理逻辑

```python
def process_batch(self, images):
    # images 形状: [batch, height, width, channels]
    batch_size = images.shape[0]  # 获取图片数量
    
    # 拆分为单独的图片，但保持维度
    image_list = []
    for i in range(batch_size):
        img = images[i:i+1]  # 形状: [1, height, width, channels]
        image_list.append(img)
    
    return ({"images": image_list},)
```

### 与其他节点兼容

输出的 `MULTI_VIEW_IMAGES` 格式与以下节点完全兼容：
- ✅ MultiView3DPreview (3D预览)
- ✅ SaveMultiView3D (保存3D预览HTML)

## 📋 完整工作流示例

```json
{
  "nodes": [
    {
      "id": 1,
      "type": "LoadVideo",
      "title": "加载视频"
    },
    {
      "id": 2,
      "type": "ExtractFrames",
      "title": "提取关键帧",
      "inputs": {
        "video": ["1", 0],
        "frame_count": 8
      }
    },
    {
      "id": 3,
      "type": "MultiViewImageBatch",
      "title": "多视角图片批量输入",
      "inputs": {
        "images": ["2", 0]
      }
    },
    {
      "id": 4,
      "type": "MultiView3DPreview",
      "title": "3D预览",
      "inputs": {
        "multi_view_images": ["3", 0],
        "preview_mode": "carousel",
        "rotation_speed": 1.0,
        "auto_rotate": true
      }
    }
  ]
}
```

## 🎨 预览模式选择

无论使用哪种输入方式，都支持三种预览模式：

### 1. Carousel (环形) 🎠
- 图片围成一圈
- 适合 360° 环绕拍摄
- 推荐 6-8 张图片

### 2. Sphere (球形) 🌐
- 图片在球面分布
- 适合全方位拍摄
- 推荐 5-8 张图片

### 3. Cube (立方体) 📦
- 前后左右上下六面
- 适合正交视角
- 推荐 6 张图片

## ❓ 常见问题

**Q: 我的图片是列表，应该用哪个节点？**

A: 使用 **MultiViewImageBatch (多视角图片批量输入)** 📦

**Q: 我有 10 个单独的图片文件，应该用哪个节点？**

A: 使用 **MultiViewImageInput (多视角图片输入（单个）)**，虽然最多支持 8 个

**Q: 批量输入节点支持多少张图片？**

A: 没有限制！可以接受任意数量的图片（取决于你的内存）

**Q: 如何知道我的图片是不是批量格式？**

A: 在 ComfyUI 中，如果节点输出显示 `IMAGE [N]` 或者形状显示 `[N, H, W, C]`，就是批量格式

**Q: 可以混合使用两种输入方式吗？**

A: 不能直接混合，但可以先用批量节点，然后分离出单个图片再重组

## 🚀 性能优势

批量输入方式的优势：

| 特性 | 单个输入 | 批量输入 |
|------|---------|---------|
| 连线数量 | N 根 | 1 根 |
| 节点数量 | N+1 个 | 2 个 |
| 处理速度 | 较慢 | 较快 |
| 工作流复杂度 | 高 | 低 |
| 扩展性 | 最多 8 张 | 无限制 |

## 📝 更新日志

### v1.1.0 (2026-01-12)
- ✨ 新增 MultiViewImageBatch 节点
- 🎯 支持直接接受图片列表输入
- 📖 添加批量输入使用文档

---

## 💡 提示

如果你经常使用批量生成的图片，**强烈推荐使用批量输入节点**，可以大大简化你的工作流！

需要帮助？查看 [README.md](README.md) 或提交 Issue。
